<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Low Latency Programming</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">


<section data-background-image="pics/Amsterdam.jpg">
	<h1>Low Latency Programming</h1>
	<div>David Gross</div>
	<div>Walther Zwart</div>
	<div>Optiver</div>
	<img src="pics/optiver_logo_white.png" style="border:none; background:none"/>
</section>

<section data-background-image="pics/Amsterdam.jpg">
	<h3>About David</h3>
	<ul>
		<li>MSc Computer Science UTC (France)</li>
		<li>15+ years of programming</li>
		<li>10+ years of C++
		<li>4+ years at Optiver</li>
		<li><a href="https://github.com/david-grs">https://github.com/david-grs</a></li>
	</ul>
</section>

<section data-background-image="pics/Amsterdam.jpg">
	<h3>About Walther</h3>
	<ul>
		<li>MSc Applied Physics</li>
		<li>30+ years of programming</li>
		<li>20+ years of C++
		<li>5+ years at Optiver</li>
		<li><a href="https://github.com/wahez">https://github.com/wahez</a></li>
	</ul>
</section>

<section data-background-image="pics/Amsterdam.jpg">
	<h3>About this workshop</h3>
	<ul>
		<li>Process of improving latency</li>
		<li>Some useful tools &mdash; mostly Linux</li>
		<li>Actual C++ code</li>
	</ul>
</section>

<section data-background-image="pics/Amsterdam.jpg">
	<h3>About Optiver</h3>
	<ul>
		<li>Amsterdam, Sydney, Chicago, Shanghai</li>
		<li>1986</li>
		<li>440 people</li>
		<li>45 nationalities</li>
		<li><b>Summer internship!</b></li>
	</ul><br/>
	<img src="pics/optiver_logo_white.png" style="border:none; background:none"/>
</section>

<section data-background-image="pics/Amsterdam.jpg">
	<h3>About Optiver</h3>
	<ul>
		<li>Market Making</li>
		<li>Provide prices</li>
		<li>Improve the market</li>
		<li>Calculate the correct price</li>
		<li>Being faster than the competition</li>
	</ul>
</section>

<section>
	<h3>What is low latency programming</h3>
	<ul>
		<li>It's not about throughput!</li>
		<li>Ability to quickly react to an event</li>
		<li>CPU-bound tasks, IO is outside of the scope</li>
		<li>It's all about time</li>
	</ul>
</section>

<section>
	<h3>There is no silver bullet...</h3>
	<ul>
		<li>No compiler flags</li>
		<li>No kernel config option</li>
		<li>No library</li>
	</ul>
</section>

<section>
	<h3>...but there are golden rules</h3>
	<ul class="fragment">
		<li>Measure</li>
		<li>Do not optimize prematurely</li>
		<li>Know your problem</li>
		<li>Know your libraries</li>
		<li>Know your hardware</li>
	</ul>
</section>

<section>
	<h3>How fast is fast?</h3>
	<div class="stretch">
		<img src="pics/Eiffel-Tower.jpg"/>
		<img src="pics/arrow-300m.png" class="fragment fade-in" style="border: none; background: none"/>
		<img src="pics/arrow-1us.png" class="fragment fade-in" style="border: none; background: none"/>
	</div>
</section>

<section>
	<h3>CPU architecture - Intel Haswell</h3>
	<p><img src="pics/haswell.jpg"/></p>
</section>

<section>
	<h3>CPU architecture - Intel Haswell</h3>
	<p><img src="pics/intel_core_i7_architecture.png"/></p>
</section>

<section>
	<h1>Steps</h1>
	<h3>Identify the hot path</h3>
	<h3>Algorithmic complexity</h3>
	<h3>Allocations</h3>
	<h3>Cache coherence</h3>
	<h3>CPU instructions</h3>
</section>

<section>
	<h1>Tools</h1>
    <ol>
        <li>Google Benchmark</li>
        <li>Valgrind, callgrind &amp; kcachegrind</li>
        <li>Papi++</li>
        <li>Perf</li>
    </ol>
</section>

<section>
	<h3>Google Benchmark</h3>
    <ul>
        <li>Allows for easy creation of microbenchmarks</li>
        <li><a href="https://github.com/google/benchmark">https://github.com/google/benchmark</a></li>
    </ul>
</section>

<section>
	<h3>Valgrind, callgrind &amp; kcachegrind</h3>
    <ul>
        <li>Instrumentation framework</li>
        <li>Unix only</li>
        <li>Callgrind - profiler</li>
        <li>KCachegrind - GUI</li>
    </ul>
</section>

<section>
	<h3>Papi++</h3>
    <ul>
        <li>Provides access to Hardware Performance Counters from within the program</li>
        <li><a href="https://github.com/david-grs/papipp"> https://github.com/david-grs/papipp</a></li>
    </ul>
</section>

<section>
	<h3>Perf</h3>
	<ul>
		<li>"The official" Linux profiler</li>
		<li>Has access to the same counters as PAPI</li>
		<li>Instruments running binary</li>
		<li>Produces nice reports</li>
		<li>And so much more!</li>
	</ul>
</section>

<section>
	<h3>Summary</h3>
	<ul>
		<li>Always measure</li>
		<li>Keep an eye on algorithmic complexity</li>
		<li>Avoid allocations / synchronization</li>
		<li>Use cache efficiently</li>
		<li>Look into generated assembly</li>
		<!-- Last three are where low level languages work best -->
	</ul>
</section>

<section>
	<h3>Links, resources, tools</h3>
	<ul>
		<li><a href="https://david-grs.github.io/low_latency_presentation/">https://david-grs.github.io/low_latency_presentation/</a></li>
		<li><a href="https://www.youtube.com/watch?v=NH1Tta7purM">â€œWhen a Microsecond Is an Eternity", Carl Cook, CppCon 2017</a></li>
		<li>Papi++ : <a href="https://github.com/david-grs/papipp">https://github.com/david-grs/papipp</a></li>
		<li>Google Benchmark</li>
		<li>valgrind --tool=callgrind, KCachegrind</li>
		<li>perf</li>
		<li><b><a href="http://www.optiver.com">http://www.optiver.com</a></b></li>
	</ul>
</section>

<section>
	<img src="pics/hiring.png" style="border:none; background:none; width:60%"/>
</section>

			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				history: true,
				width: "120%",
				transitionSpeed: 'fast',

				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/chart/Chart.min.js' },
					{ src: 'plugin/chart/csv2chart.js' },
				],

				chart: {
						defaults: {
							global: {
								title: { fontColor: "#FFF" },
								legend: {
									labels: { fontColor: "#FFF" },
								},
							},
							scale: {
								scaleLabel: { fontColor: "#FFF", labelString: 'ns' },
								gridLines: { color: "#FFF", zeroLineColor: "#FFF" },
								ticks: { fontColor: "#FFF", beginAtZero: true },
							}
						},
						bar: { backgroundColor: [ "rgba(20,220,220,.8)" , "rgba(220,120,120,.8)", "rgba(20,120,220,.8)" ]},
					},
			});
			Reveal.configure({ slideNumber: true, slideNumber: 'c/t' });
		</script>
	</body>
</html>
